# üéµ Aplicaci√≥n Vinilos

Una aplicaci√≥n m√≥vil para gestionar y explorar discos de vinilo, construida siguiendo pr√°cticas modernas de desarrollo Android.

---

## üõ†Ô∏è Arquitectura

La aplicaci√≥n implementa el patr√≥n **MVVM** (Model-View-ViewModel) y principios de **Clean Architecture**, proporcionando una clara separaci√≥n de responsabilidades y facilitando la mantenibilidad y el testeo.

---

## üì¶ Estructura y Componentes del Proyecto

### Capa de Datos

1. **Modelos**
   - Ubicados en `app/src/main/java/com/uniandes/vinilos/models/`
   - Definen las estructuras de datos utilizadas en la aplicaci√≥n
   - Ejemplo:
   ```kotlin
   data class Album(
       val id: Int,
       val name: String,
       val cover: String,
       val releaseDate: String,
       val description: String,
       val genre: String,
       val recordLabel: String,
       val tracks: List<Track>,
       val comments: List<Comment>,
       val performers: List<Performer>
   )
   ```

2. **DAOs (Objetos de Acceso a Datos)**
   - Ubicados en `app/src/main/java/com/uniandes/vinilos/data/dao/`
   - Definen interfaces para operaciones de datos
   - Implementados por DAOs de API que utilizan Retrofit
   - Ejemplo:
   ```kotlin
   interface AlbumDao {
       suspend fun getAllAlbums(): List<Album>
       suspend fun getAlbumById(id: Int): Album?
       suspend fun getAlbumTracks(albumId: Int): List<Track>
   }

   @ActivityRetainedScoped
   class ApiAlbumDao @Inject constructor(
       private val albumService: AlbumService
   ) : AlbumDao {
       override suspend fun getAllAlbums(): List<Album> {
           return try {
               val response = albumService.getAlbums()
               if (response.isSuccessful) {
                   response.body() ?: emptyList()
               } else {
                   emptyList()
               }
           } catch (e: Exception) {
               emptyList()
           }
       }
   }
   ```

3. **Servicios de Red**
   - Ubicados en `app/src/main/java/com/uniandes/vinilos/network/`
   - Definen endpoints de API usando Retrofit
   - Ejemplo:
   ```kotlin
   interface AlbumService {
       @GET("albums")
       suspend fun getAlbums(): Response<List<Album>>

       @GET("albums/{id}")
       suspend fun getAlbum(@Path("id") id: Int): Response<Album>

       @GET("albums/{id}/tracks")
       suspend fun getAlbumTracks(@Path("id") id: Int): Response<List<Track>>
   }
   ```

4. **Repositorios**
   - Ubicados en `app/src/main/java/com/uniandes/vinilos/data/repository/`
   - Act√∫an como fuente √∫nica de verdad para los datos
   - Utilizan DAOs para obtener datos de la red
   - Ejemplo:
   ```kotlin
   @Singleton
   class AlbumRepository @Inject constructor(
       private val albumDao: AlbumDao
   ) {
       suspend fun getAllAlbums(): List<Album> {
           return albumDao.getAllAlbums()
       }

       suspend fun getAlbumById(id: Int): Album? {
           return albumDao.getAlbumById(id)
       }

       suspend fun getAlbumTracks(albumId: Int): List<Track> {
           return albumDao.getAlbumTracks(albumId)
       }
   }
   ```

#### Inyecci√≥n de Dependencias
- Utiliza Hilt para la inyecci√≥n de dependencias
- Configuraci√≥n de red en `NetworkModule.kt`:
```kotlin
@Module
@InstallIn(SingletonComponent::class)
object NetworkModule {
    private const val BASE_URL = "http://146.190.65.12:3000/"

    @Provides
    @Singleton
    fun provideRetrofit(okHttpClient: OkHttpClient): Retrofit {
        return Retrofit.Builder()
            .baseUrl(BASE_URL)
            .client(okHttpClient)
            .addConverterFactory(GsonConverterFactory.create())
            .build()
    }

    @Provides
    @Singleton
    fun provideAlbumService(retrofit: Retrofit): AlbumService {
        return retrofit.create(AlbumService::class.java)
    }
}
```

---

### Capa de UI

1. **Fragments**
   - Ubicados en `app/src/main/java/com/uniandes/vinilos/ui/fragments/`
   - Manejan el renderizado de UI y las interacciones del usuario
   - Ejemplo:
   ```kotlin
   class AlbumListFragment : Fragment() {
       private val viewModel: AlbumViewModel by viewModels()
       private lateinit var binding: FragmentAlbumListBinding
       
       override fun onCreateView(
           inflater: LayoutInflater,
           container: ViewGroup?,
           savedInstanceState: Bundle?
       ): View {
           binding = FragmentAlbumListBinding.inflate(inflater, container, false)
           return binding.root
       }
       
       override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
           super.onViewCreated(view, savedInstanceState)
           setupRecyclerView()
           observeViewModel()
       }
   }
   ```

2. **ViewModels**
   - Ubicados en `app/src/main/java/com/uniandes/vinilos/ui/viewmodel/`
   - Manejan la l√≥gica de negocio y la transformaci√≥n de datos
   - Ejemplo:
   ```kotlin
   class AlbumViewModel @Inject constructor(
       private val albumRepository: AlbumRepository
   ) : ViewModel() {
       private val _albums = MutableStateFlow<List<Album>>(emptyList())
       val albums: StateFlow<List<Album>> = _albums.asStateFlow()
       
       fun loadAlbums() {
           viewModelScope.launch {
               albumRepository.getAlbums().collect { albums ->
                   _albums.value = albums
               }
           }
       }
   }
   ```

### Implementaci√≥n de Navegaci√≥n

La aplicaci√≥n utiliza el Navigation Component con una arquitectura de actividad √∫nica:

1. **Grafo de Navegaci√≥n**
   - Ubicado en `app/src/main/res/navigation/nav_graph.xml`
   - Define todos los posibles caminos de navegaci√≥n
   ```xml
   <navigation xmlns:android="http://schemas.android.com/apk/res/android"
       xmlns:app="http://schemas.android.com/apk/res-auto"
       android:id="@+id/nav_graph"
       app:startDestination="@id/roleSelectionFragment">
       
       <fragment
           android:id="@+id/roleSelectionFragment"
           android:name="com.uniandes.vinilos.ui.fragments.RoleSelectionFragment"
           android:label="Seleccionar Rol">
           <action
               android:id="@+id/action_roleSelection_to_albumList"
               app:destination="@id/albumListFragment" />
       </fragment>
       
       <fragment
           android:id="@+id/albumListFragment"
           android:name="com.uniandes.vinilos.ui.fragments.AlbumListFragment"
           android:label="√Ålbumes">
           <action
               android:id="@+id/action_albumList_to_albumDetail"
               app:destination="@id/albumDetailFragment" />
       </fragment>
   </navigation>
   ```

2. **Navegaci√≥n en Fragments**
   ```kotlin
   // Navegar al detalle del √°lbum
   findNavController().navigate(
       AlbumListFragmentDirections.actionAlbumListToAlbumDetail(albumId)
   )
   
   // Navegar hacia atr√°s
   findNavController().navigateUp()
   ```

3. **Safe Args**
   - Utilizado para navegaci√≥n con tipos seguros
   - Generado por el Navigation Component
   - Ejemplo:
   ```kotlin
   // En AlbumListFragment
   val action = AlbumListFragmentDirections
       .actionAlbumListToAlbumDetail(albumId)
   findNavController().navigate(action)
   
   // En AlbumDetailFragment
   val albumId = arguments?.let { 
       AlbumDetailFragmentArgs.fromBundle(it).albumId 
   }
   ```

## Pruebas

La aplicaci√≥n utiliza pruebas instrumentadas con Espresso para verificar la funcionalidad de la UI.

### Estructura de Pruebas

Las pruebas se encuentran en:
- `app/src/androidTest/java/com/uniandes/vinilos/ui/albums/`
- Utilizan Espresso para pruebas de UI
- Se enfocan en la interacci√≥n con la interfaz de usuario

### Ejemplo de Prueba con Espresso

```kotlin
@HiltAndroidTest
class AlbumListFragmentTest {
    @Test
    fun testAlbumListFragment_UIElements() {
        // Configuraci√≥n
        onView(withId(R.id.visitorRole)).perform(click())
        onView(withId(R.id.continueButton)).perform(click())
        
        // Verificaci√≥n
        onView(withId(R.id.albumsRecyclerView))
            .check(matches(isDisplayed()))
    }

    @Test
    fun testAlbumDetailFragment_BasicInfo() {
        // Verificar que todos los elementos b√°sicos de informaci√≥n se muestran
        onView(withId(R.id.albumCoverImageView))
            .check(matches(isDisplayed()))
        onView(withId(R.id.albumTitleTextView))
            .check(matches(isDisplayed()))
        onView(withId(R.id.albumArtistTextView))
            .check(matches(isDisplayed()))
        onView(withId(R.id.albumGenreTextView))
            .check(matches(isDisplayed()))
        onView(withId(R.id.albumReleaseDateTextView))
            .check(matches(isDisplayed()))
        onView(withId(R.id.albumDescriptionTextView))
            .check(matches(isDisplayed()))
    }

    @Test
    fun testAlbumDetailFragment_TracksList() {
        // Verificar que el RecyclerView de tracks se muestra
        onView(withId(R.id.tracksRecyclerView))
            .check(matches(isDisplayed()))
            .check(matches(hasMinimumChildCount(1)))
    }

    @Test
    fun testAlbumDetailFragment_PerformersList() {
        // Verificar que el RecyclerView de performers se muestra
        onView(withId(R.id.performersRecyclerView))
            .check(matches(isDisplayed()))
            .check(matches(hasMinimumChildCount(1)))
    }
}
```

### Ejecuci√≥n de Pruebas

Hay dos formas de ejecutar las pruebas:

1. **A trav√©s de la l√≠nea de comandos:**
   ```bash
   ./gradlew connectedAndroidTest
   ```

2. **A trav√©s de Android Studio:**
   - Abrir el archivo de prueba
   - Hacer clic derecho sobre el archivo o m√©todo de prueba
   - Seleccionar "Run 'NombreDelTest'"
   - Tambi√©n se pueden ejecutar pruebas individuales haciendo clic en el √≠cono de "play" junto al m√©todo de prueba

Las pruebas verifican:
1. Visualizaci√≥n correcta de elementos UI
2. Interacci√≥n con botones y controles
3. Navegaci√≥n entre pantallas
4. Carga y visualizaci√≥n de datos
5. Comportamiento de listas y RecyclerViews

## Construcci√≥n de la Aplicaci√≥n

### Generaci√≥n de APK

1. **APK de Depuraci√≥n**
   ```bash
   ./gradlew assembleDebug
   ```
   Salida: `app/build/outputs/apk/debug/app-debug.apk`

2. **APK de Lanzamiento**
   ```bash
   ./gradlew assembleRelease
   ```
   Salida: `app/build/outputs/apk/release/app-release.apk`


## üìö Dependencias

La aplicaci√≥n utiliza varias bibliotecas modernas de Android:

- **Hilt**: Inyecci√≥n de dependencias
- **Retrofit**: Llamadas de red
- **Coroutines**: Programaci√≥n as√≠ncrona
- **Flow**: Flujos reactivos
- **Navigation Component**: Manejo de navegaci√≥n
- **ViewBinding**: Vinculaci√≥n de vistas
- **Material Design**: Componentes de UI

---

## Estructura del Proyecto

```
app/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/com/uniandes/vinilos/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/          # Modelos de datos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ network/         # Servicios de API
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/      # Repositorios de datos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/             # Componentes de UI
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fragments/   # Fragments
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ viewmodel/   # ViewModels
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/          # Clases de utilidad
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ res/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ layout/         # Archivos de layout
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ navigation/     # Grafos de navegaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ test/                   # Pruebas unitarias
‚îÇ   ‚îî‚îÄ‚îÄ androidTest/            # Pruebas instrumentadas
```

---

